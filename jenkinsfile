pipeline {
    agent any 
    stages {
        stage('Build') { 
            steps {
                   dockerComposeUp(
                    // Example parameters (check the snippet generator for actual parameters)
                    composeFile: 'compose.yml',
                    projectName: 'pdffullsearch',
                    waitForCompletion: true
                )
            }
        }
        stage('Test') { 
            steps {
                sh "echo testing"
                sh 'docker-compose -f compose.yml up --build -d'
            }
        }
        stage('Deploy to staging') { 
            steps {
                sh "echo deploying" 
            }
        }

        stage('Deploy to production') { 
            steps {
                sh "echo deploying" 
            }
        }
    }

post{
    failure{
        mail bcc: '', body: "<b> Failed Jenkins Buid </b><br>Project: ${env.JOB_NAME} \
         <br> Build Number: ${env.BUILD_NUMBER} <br> Build URL: ${env.BUILD_URL} ", cc: '', \
         charset: 'UTF-8', from: 'jenkins@gmendez.net', mimeType: 'text/html', replyTo: '', \
         subject: "Jenkins Build Failed: ${env.JOB_NAME} - Build # ${env.BUILD_NUMBER}", \
         to:'ing.fernando.luque@gmail.com'; 
         }
    }

}
