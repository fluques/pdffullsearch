pipeline {
    agent any 
    plugins {
        // This ensures the plugin is available for the pipeline
        dockerComposeBuildStep()
    }
    stages {
        stage('Build') { 
            steps {
                sh "echo building"
                sh "cp env.sample .env"
                dockerComposeUp composeFile: 'docker-compose.yml', detached: true
            }
        }
        stage('Test') { 
            steps {
                sh "echo testing"
            }
        }
        stage('Deploy to staging') { 
            steps {
                sh "echo deploying" 
            }
        }

        stage('Deploy to production') { 
            steps {
                sh "echo deploying" 
            }
        }
    }

post{
    failure{
        mail bcc: '', body: "<b> Failed Jenkins Buid </b><br>Project: ${env.JOB_NAME} \
         <br> Build Number: ${env.BUILD_NUMBER} <br> Build URL: ${env.BUILD_URL} ", cc: '', \
         charset: 'UTF-8', from: 'jenkins@gmendez.net', mimeType: 'text/html', replyTo: '', \
         subject: "Jenkins Build Failed: ${env.JOB_NAME} - Build # ${env.BUILD_NUMBER}", \
         to:'ing.fernando.luque@gmail.com'; 
         }
    }

}
